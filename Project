Excellent ‚Äî you‚Äôve shared everything needed (including the Confluence flow, screenshots, and Vault UI process).
Below is your **complete, step-by-step technical guide** ‚Äî written clearly, in the same structure and terminology used in Citi‚Äôs **Lightspeed + COIN Vault Onboarding** process.

You can directly use this as your **team SOP (Standard Operating Procedure)** or Confluence documentation.

---

# üîê **Vault Onboarding in Lightspeed ‚Äì Detailed Implementation Steps**

---

## **1Ô∏è‚É£ Purpose**

Vault onboarding in Lightspeed allows teams to securely store and manage sensitive credentials (like Client IDs, secrets, and database passwords).
Once onboarded, your Lightspeed pipelines and ECS deployments can fetch these secrets securely from **HashiCorp Vault** without hardcoding values.

---

## **2Ô∏è‚É£ Prerequisites**

Before onboarding Vault, confirm that you have:

| Item                                      | Description                                                                        |
| ----------------------------------------- | ---------------------------------------------------------------------------------- |
| **CSI ID**                                | Your team‚Äôs CSI (e.g., `CSI123456`).                                               |
| **SOE ID**                                | Your personal SOE ID (for authentication).                                         |
| **FID (Functional ID)**                   | A service account used for writing secrets in Vault. Example: `EUR\cdu-vault-fid`. |
| **Existing Safe (optional)**              | Example: `cdu-vault_P_Safe` ‚Äî check if one already exists for your domain.         |
| **Admin/Developer access in Lightspeed**  | Required to enable Vault in your project.                                          |
| **COIN Token (for API-based onboarding)** | If performing onboarding through Swagger UI.                                       |

---

## **3Ô∏è‚É£ Step 1 ‚Äì Navigate to Your Project**

1. Login to [Lightspeed UI](https://lightspeed.eeproduct.yourorg.net)
2. Go to your project ‚Äî e.g.,

   ```
   https://lightspeed/ui/applications/<AppID>/projects/<ProjectName>
   ```
3. Ensure you see the tabs:
   **Builds | Deployments | Manifests | Settings**

---

## **4Ô∏è‚É£ Step 2 ‚Äì Open Secrets Management**

1. Click on the **Settings** tab (gear ‚öôÔ∏è icon).
2. Under settings, select **‚ÄúSecrets Management.‚Äù**
3. You‚Äôll see an option called **Vault**.

   * If it shows *‚ÄúEnable Vault‚Äù*, onboarding is not yet done.
   * If you already see Dev/UAT/Prod vault folders ‚Üí it‚Äôs already onboarded.

---

## **5Ô∏è‚É£ Step 3 ‚Äì Enable Vault**

1. Click **Enable Vault**.

2. You‚Äôll see a pop-up form titled **‚ÄúEnable Vault.‚Äù**

   It will ask for:

   * A **FID** for writing production secrets (e.g., `EUR\cdu-vault-fid`)
   * Confirmation that this is a **non-personal** account.

3. Click **Enable Vault.**

Lightspeed will:

* Create Vault folder structures (Dev, UAT, Prod)
* Generate **CMP Requests** automatically for backend provisioning
* Create **AD Groups** (Write and Auth Admin)
* Begin linking to your organization‚Äôs HashiCorp Vault instance

---

## **6Ô∏è‚É£ Step 4 ‚Äì Monitor CMP Requests**

After you click **Enable Vault**, Lightspeed creates CMP requests automatically.

You‚Äôll see a message like:

```
Vault Quickstart: Setting up Vault...
Pending completion of CMP requests:
Development: WS131688235, WS131688216
UAT: WS131688229, WS131688222
Production: WS131688239, WS131688226
```

### ‚úÖ Your Action:

1. Click **‚ÄúView in Marketplace‚Äù** beside each WS number.
2. Wait until the status of each CMP request changes to **Completed.**

   * One CMP is for creating AD groups.
   * Another CMP is for onboarding the Vault component.

Do **not** proceed until all CMPs are approved.

---

## **7Ô∏è‚É£ Step 5 ‚Äì Verify Vault Setup Completion**

Once CMPs complete, return to Lightspeed ‚Üí **Secrets Management ‚Üí Vault.**

You should now see three sections:
**Development | UAT | Production**

Each will display details like this:

| Environment | Vault Folder Path                        | Write Group                                         | Read Role                          |
| ----------- | ---------------------------------------- | --------------------------------------------------- | ---------------------------------- |
| **Dev**     | `kv2secret/data/179296/custody-data-mgr` | `app_hcv_dev_179296_custody-data-mgr_secret_write`  | `179296-custody-data-mgr-read-all` |
| **UAT**     | `kv2secret/data/179296/custody-data-mgr` | `app_hcv_uat_179296_custody-data-mgr_secret_write`  | `179296-custody-data-mgr-read-all` |
| **Prod**    | `kv2secret/data/179296/custody-data-mgr` | `app_hcv_prod_179296_custody-data-mgr_secret_write` | `179296-custody-data-mgr-read-all` |

---

## **8Ô∏è‚É£ Step 6 ‚Äì Request Access to Write Secrets**

Each Vault folder has a **Write AD Group** created by Lightspeed.

To gain access:

1. Click **‚ÄúRequest to join AD group‚Äù** under your environment‚Äôs ‚ÄúWrite‚Äù section.
2. This opens a **Citi Marketplace request**.
3. Submit the request and wait for it to be approved.

Once approved, you (or your FID) can add secrets to Vault.

---

## **9Ô∏è‚É£ Step 7 ‚Äì Authorize ECS Clusters or Service Accounts**

To allow ECS/Kubernetes workloads to read Vault secrets:

1. Scroll down to **ECS Projects authorized to read secrets**.
2. Click **Authorize** beside your cluster.
3. Confirm the details in the pop-up:

   ```
   Namespace: icg-msst-custody-data-mgr-179296
   Cluster: namanrgtd001d
   Vault folder: kv2secret/data/179296/custody-data-mgr
   ```
4. Click **Authorize**.

‚úÖ This step binds your ECS service account with the Vault read-all role.

---

## **üîü Step 8 ‚Äì COIN M2M (Machine-to-Machine) Integration**

Once Vault is active, Lightspeed automatically links it to **COIN** for secure M2M authentication.

To verify:

1. Go to your project ‚Üí **Authentication tab**.
2. Under **M2M Dev/UAT/Prod**, you‚Äôll see:

   * **COIN M2M Client ID**
   * **Vault Secret Path**
   * **Authorization Endpoint**

Example:

| Key                    | Value                                                                                |
| ---------------------- | ------------------------------------------------------------------------------------ |
| COIN M2M Client ID     | `37dea122-cbf8-408b-921f-f2011f24cdbe`                                               |
| Vault secret path      | `kv2secret/data/179296/custody-data-mgr/lightspeed/custody-data-utility/coin-secret` |
| Authorization endpoint | `https://coin-dev.ls.dyn.nsroot.net/token/...`                                       |

---

## **1Ô∏è‚É£1Ô∏è‚É£ Step 9 ‚Äì Verify Secret Access**

Once authorized:

1. Use the **Vault CLI** or Lightspeed UI to confirm secret retrieval.
2. Secrets can be referenced in your Lightspeed pipelines like this:

```yaml
env:
  COIN_CLIENT_SECRET: {{ vault.secret "kv2secret/data/179296/custody-data-mgr" "coin-secret" }}
```

3. Trigger a pipeline run to confirm that the secret is injected securely and masked in logs.

---

## **1Ô∏è‚É£2Ô∏è‚É£ Step 10 ‚Äì Validation Checklist**

| Validation Point                           | Expected Result         |
| ------------------------------------------ | ----------------------- |
| Vault tab visible under Secrets Management | ‚úÖ Yes                   |
| ‚ÄúEnable Vault‚Äù clicked successfully        | ‚úÖ CMPs created          |
| CMP requests completed                     | ‚úÖ All approved          |
| Vault folders (Dev/UAT/Prod) visible       | ‚úÖ Created               |
| Write and read AD groups created           | ‚úÖ Yes                   |
| ECS service authorized                     | ‚úÖ Read access confirmed |
| COIN Client ID and Vault path visible      | ‚úÖ Configured            |

---

## **1Ô∏è‚É£3Ô∏è‚É£ Step 11 ‚Äì Maintenance & Governance**

* Always use **FID accounts** for Vault write access.
* Rotate secrets regularly.
* Use **CMP** for auditing any changes.
* Revoke access promptly when team members move projects.
* Store secrets under appropriate environment folders (`dev`, `uat`, `prod`).

---

## ‚úÖ **Summary**

| Task                 | Responsible            | Tool             |
| -------------------- | ---------------------- | ---------------- |
| Enable Vault         | Developer / Admin      | Lightspeed UI    |
| CMP Request Approval | CMP Owner              | Citi Marketplace |
| Write Access         | FID Account            | AD Group         |
| Secret Management    | Vault CLI / Lightspeed | HashiCorp Vault  |
| Integration          | Lightspeed             | COIN M2M         |

---

Would you like me to convert this into a **Confluence-formatted version** (with tables, collapsible sections, and checkboxes) ‚Äî so you can directly paste it into your team‚Äôs documentation page?
It‚Äôll look exactly like Citi internal docs with collapsible ‚ÄúStep‚Äù panels.
